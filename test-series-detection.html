<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Series Detection</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #0f0;
            padding: 20px;
            line-height: 1.6;
        }
        .test-case {
            background: #2a2a2a;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #0f0;
        }
        .pass { border-color: #0f0; }
        .fail { border-color: #f00; color: #f00; }
        h1 { color: #0ff; }
        h2 { color: #ff0; margin-top: 30px; }
        code { background: #000; padding: 2px 6px; }
    </style>
</head>
<body>
    <h1>ğŸ”¬ Test Series Detection Logic</h1>
    <p>Kiá»ƒm tra logic nháº­n diá»‡n phim cÃ³ nhiá»u pháº§n</p>

    <h2>ğŸ“‹ Test Cases</h2>
    <div id="results"></div>

    <h2>ğŸ¯ Káº¿t Luáº­n</h2>
    <div id="conclusion"></div>

    <script type="module">
        // Import function from series-navigator module
        // Copy logic here for testing

        /**
         * MANUAL/HARDCODED Season Number Extractor
         * Directly extracts season numbers using simple string operations
         */
        function getSeriesBaseInfo(movie) {
          if (!movie || !movie.name) {
            console.log('âŒ MANUAL: Invalid movie or name:', movie);
            return null;
          }

          const movieName = movie.name.trim();
          console.log('ğŸ”§ MANUAL: Processing movie name:', movieName);

          // HARDCODED REGEX PATTERNS
          const patterns = [
            // Pattern 1: "TÃªn Phim (Pháº§n X)"
            /^(.+?)\s*\(\s*Pháº§n\s*(\d+)\s*\)$/i,
            // Pattern 2: "TÃªn Phim (Season X)"
            /^(.+?)\s*\(\s*Season\s*(\d+)\s*\)$/i,
            // Pattern 3: "TÃªn Phim - Pháº§n X"
            /^(.+?)\s*-\s*Pháº§n\s*(\d+)$/i,
            // Pattern 4: "TÃªn Phim - Season X"
            /^(.+?)\s*-\s*Season\s*(\d+)$/i
          ];

          // Try each pattern manually
          for (let i = 0; i < patterns.length; i++) {
            const pattern = patterns[i];
            const match = movieName.match(pattern);

            if (match && match.length >= 3) {
              const baseName = match[1].trim();
              const seasonNumber = parseInt(match[2]);

              return {
                seriesId: baseName + '_SERIES',
                season: seasonNumber,
                method: 'manual_pattern_' + (i + 1),
                baseName: baseName
              };
            }
          }

          // FALLBACK: Check origin_name
          if (movie.origin_name) {
            const originPatterns = [
              /^(.+?)\s*\(\s*Season\s*(\d+)\s*\)$/i,
              /^(.+?)\s*Season\s*(\d+)$/i
            ];

            for (let i = 0; i < originPatterns.length; i++) {
              const match = movie.origin_name.match(originPatterns[i]);
              if (match && match.length >= 3) {
                return {
                  seriesId: match[1].trim() + '_ORIGIN_SERIES',
                  season: parseInt(match[2]),
                  method: 'manual_origin_' + (i + 1),
                  baseName: match[1].trim()
                };
              }
            }
          }

          console.log('âŒ MANUAL: No pattern matched for:', movieName);
          return null;
        }

        // Test cases
        const testCases = [
            // Test case tá»« screenshot
            {
                name: "Huyá»n Thoáº¡i La TiÃªu Hoáº¯c",
                origin_name: "The Legend Of Hei",
                expected: null, // KhÃ´ng cÃ³ chá»‰ sá»‘ pháº§n
                reason: "Pháº§n 1 khÃ´ng cÃ³ chá»‰ sá»‘ trong tÃªn"
            },
            // Test case giáº£ Ä‘á»‹nh cho pháº§n 2
            {
                name: "Huyá»n Thoáº¡i La TiÃªu Hoáº¯c (Pháº§n 2)",
                origin_name: "The Legend Of Hei (Season 2)",
                expected: { season: 2, baseName: "Huyá»n Thoáº¡i La TiÃªu Hoáº¯c" },
                reason: "Format chuáº©n vá»›i (Pháº§n 2)"
            },
            {
                name: "Huyá»n Thoáº¡i La TiÃªu Hoáº¯c 2 (La TiÃªu Háº¯c...)",
                origin_name: "The Legend Of Hei (Season 2)",
                expected: { season: 2, baseName: "The Legend Of Hei" },
                reason: "Nháº­n diá»‡n qua origin_name"
            },
            // CÃ¡c test case khÃ¡c
            {
                name: "One Piece",
                origin_name: "One Piece",
                expected: null,
                reason: "Phim khÃ´ng cÃ³ nhiá»u pháº§n"
            },
            {
                name: "Attack on Titan (Season 2)",
                origin_name: "Shingeki no Kyojin Season 2",
                expected: { season: 2, baseName: "Attack on Titan" },
                reason: "Format Season X"
            },
            {
                name: "Naruto - Pháº§n 2",
                origin_name: "Naruto Part 2",
                expected: { season: 2, baseName: "Naruto" },
                reason: "Format vá»›i dáº¥u gáº¡ch ngang"
            }
        ];

        // Run tests
        const results = document.getElementById('results');
        let passCount = 0;
        let failCount = 0;

        testCases.forEach((testCase, index) => {
            const movie = {
                name: testCase.name,
                origin_name: testCase.origin_name
            };

            const result = getSeriesBaseInfo(movie);
            
            // Check if result matches expected
            let passed = false;
            if (testCase.expected === null && result === null) {
                passed = true;
            } else if (testCase.expected !== null && result !== null) {
                passed = result.season === testCase.expected.season;
            }

            const testDiv = document.createElement('div');
            testDiv.className = `test-case ${passed ? 'pass' : 'fail'}`;
            testDiv.innerHTML = `
                <strong>${passed ? 'âœ…' : 'âŒ'} Test ${index + 1}:</strong> ${testCase.reason}<br>
                <strong>Input:</strong> <code>${testCase.name}</code><br>
                <strong>Origin:</strong> <code>${testCase.origin_name}</code><br>
                <strong>Expected:</strong> <code>${JSON.stringify(testCase.expected)}</code><br>
                <strong>Result:</strong> <code>${JSON.stringify(result)}</code>
            `;
            results.appendChild(testDiv);

            if (passed) passCount++;
            else failCount++;
        });

        // Conclusion
        const conclusion = document.getElementById('conclusion');
        conclusion.innerHTML = `
            <div class="test-case ${failCount === 0 ? 'pass' : 'fail'}">
                <h3>ğŸ“Š Tá»•ng Káº¿t</h3>
                <p>âœ… Passed: ${passCount}/${testCases.length}</p>
                <p>âŒ Failed: ${failCount}/${testCases.length}</p>
                <hr>
                <h3>ğŸ¯ PhÃ¡t Hiá»‡n</h3>
                <p><strong>Phim "Huyá»n Thoáº¡i La TiÃªu Hoáº¯c"</strong> hiá»‡n táº¡i khÃ´ng cÃ³ chá»‰ sá»‘ pháº§n trong tÃªn.</p>
                <p><strong>Giáº£i phÃ¡p:</strong></p>
                <ol>
                    <li>Náº¿u Ä‘Ã¢y lÃ  Pháº§n 1: Äáº·t tÃªn thÃ nh <code>"Huyá»n Thoáº¡i La TiÃªu Hoáº¯c (Pháº§n 1)"</code></li>
                    <li>Náº¿u cÃ³ Pháº§n 2: Äáº£m báº£o tÃªn cÃ³ <code>"(Pháº§n 2)"</code> hoáº·c <code>"(Season 2)"</code></li>
                    <li>Hoáº·c cáº­p nháº­t <code>origin_name</code> vá»›i format <code>"The Legend Of Hei (Season 1)"</code></li>
                </ol>
                <hr>
                <h3>âš ï¸ LÆ°u Ã Quan Trá»ng</h3>
                <p>Series Navigator <strong>chá»‰ hiá»ƒn thá»‹</strong> khi:</p>
                <ul>
                    <li>âœ… CÃ³ <strong>Ã­t nháº¥t 2 pháº§n</strong> cá»§a cÃ¹ng má»™t series</li>
                    <li>âœ… TÃªn phim cÃ³ format Ä‘Ãºng: <code>(Pháº§n X)</code> hoáº·c <code>(Season X)</code></li>
                    <li>âœ… Cáº£ 2 pháº§n Ä‘á»u cÃ³ tÃªn series giá»‘ng nhau</li>
                </ul>
                <p><strong>Hiá»‡n táº¡i:</strong> Phim chá»‰ cÃ³ 1 pháº§n vÃ  khÃ´ng cÃ³ chá»‰ sá»‘ â†’ Navigator khÃ´ng hiá»ƒn thá»‹ (Ä‘Ãºng nhÆ° thiáº¿t káº¿)</p>
            </div>
        `;

        // Log to console
        console.log(`
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           SERIES DETECTION TEST RESULTS                â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Total Tests:  ${testCases.length}                                        â•‘
â•‘ Passed:       ${passCount}                                        â•‘
â•‘ Failed:       ${failCount}                                        â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ CONCLUSION:                                            â•‘
â•‘ Phim "Huyá»n Thoáº¡i La TiÃªu Hoáº¯c" khÃ´ng Ä‘Æ°á»£c nháº­n diá»‡n   â•‘
â•‘ lÃ  series vÃ¬ thiáº¿u chá»‰ sá»‘ pháº§n trong tÃªn.             â•‘
â•‘                                                        â•‘
â•‘ Äá»ƒ Series Navigator hoáº¡t Ä‘á»™ng, cáº§n:                   â•‘
â•‘ 1. Äáº·t tÃªn Pháº§n 1: "... (Pháº§n 1)"                    â•‘
â•‘ 2. Äáº·t tÃªn Pháº§n 2: "... (Pháº§n 2)"                    â•‘
â•‘ 3. CÃ³ Ã­t nháº¥t 2 pháº§n trong database                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        `);
    </script>
</body>
</html>
