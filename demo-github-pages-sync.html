<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Demo GitHub Pages Sync System</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: #121212;
      color: #fff;
      padding: 20px;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .hero {
      background: linear-gradient(135deg, #6c5ce7, #a29bfe);
      color: white;
      padding: 40px;
      border-radius: 12px;
      text-align: center;
      margin-bottom: 30px;
    }
    
    .sync-types {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin: 30px 0;
    }
    
    .sync-card {
      background: #1e1e1e;
      border: 2px solid #333;
      border-radius: 12px;
      padding: 25px;
      text-align: center;
    }
    
    .sync-card.auto {
      border-color: #00b894;
      background: linear-gradient(135deg, rgba(0, 184, 148, 0.1), rgba(0, 206, 201, 0.05));
    }
    
    .sync-card.manual {
      border-color: #6c5ce7;
      background: linear-gradient(135deg, rgba(108, 92, 231, 0.1), rgba(162, 155, 254, 0.05));
    }
    
    .sync-icon {
      font-size: 48px;
      margin-bottom: 15px;
    }
    
    .browser-icons {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 20px 0;
      font-size: 32px;
    }
    
    .device-icons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 20px 0;
      font-size: 32px;
    }
    
    .arrow {
      font-size: 24px;
      color: #6c5ce7;
      margin: 0 10px;
    }
    
    .btn {
      background: #6c5ce7;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      margin: 10px;
    }
    
    .btn:hover { opacity: 0.8; }
    .btn--success { background: #00b894; }
    .btn--warning { background: #f39c12; }
    
    .demo-section {
      background: #1e1e1e;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 25px;
      margin-bottom: 25px;
    }
    
    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    .status-indicator.active {
      background: #00b894;
      animation: pulse 2s infinite;
    }
    
    .status-indicator.inactive {
      background: #666;
    }
    
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
    
    .feature-list {
      list-style: none;
      padding: 0;
    }
    
    .feature-list li {
      padding: 8px 0;
      border-bottom: 1px solid #333;
    }
    
    .feature-list li:last-child {
      border-bottom: none;
    }
    
    .code-display {
      background: #000;
      color: #0f0;
      padding: 15px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      margin: 15px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Hero Section -->
    <div class="hero">
      <h1>🚀 GitHub Pages Sync System</h1>
      <p style="font-size: 18px; margin: 20px 0;">
        Hệ thống đồng bộ dữ liệu thông minh cho GitHub Pages
      </p>
      <p style="opacity: 0.9;">
        Auto-sync giữa trình duyệt + Manual sync giữa thiết bị
      </p>
    </div>

    <!-- Sync Types Comparison -->
    <div class="sync-types">
      <!-- Auto-Sync Card -->
      <div class="sync-card auto">
        <div class="sync-icon">🚀</div>
        <h3 style="color: #00b894; margin: 0 0 15px 0;">Auto-Sync</h3>
        <p style="color: #888; margin-bottom: 20px;">Giữa các trình duyệt trên cùng thiết bị</p>
        
        <div class="browser-icons">
          <span title="Microsoft Edge">🔵</span>
          <span class="arrow">↔️</span>
          <span title="Google Chrome">🟢</span>
          <span class="arrow">↔️</span>
          <span title="Opera">🔴</span>
        </div>
        
        <ul class="feature-list">
          <li>✅ Không cần mã code</li>
          <li>✅ Tự động phát hiện</li>
          <li>✅ Sync tức thì (1-2 giây)</li>
          <li>✅ Real-time updates</li>
          <li>✅ Cùng thiết bị</li>
        </ul>
        
        <button class="btn btn--success" onclick="testAutoSync()">🚀 Test Auto-Sync</button>
      </div>

      <!-- Manual Sync Card -->
      <div class="sync-card manual">
        <div class="sync-icon">📱</div>
        <h3 style="color: #6c5ce7; margin: 0 0 15px 0;">Manual Sync</h3>
        <p style="color: #888; margin-bottom: 20px;">Giữa PC và điện thoại (khác thiết bị)</p>
        
        <div class="device-icons">
          <span title="PC/Laptop">💻</span>
          <span class="arrow">↔️</span>
          <span title="Smartphone">📱</span>
        </div>
        
        <ul class="feature-list">
          <li>🔑 Dùng mã sync 6 số</li>
          <li>⏰ Mã có hiệu lực 24h</li>
          <li>🔒 Bảo mật cao</li>
          <li>🌐 Cross-platform</li>
          <li>📱 PC ↔ điện thoại</li>
        </ul>
        
        <button class="btn" onclick="testManualSync()">📱 Test Manual Sync</button>
      </div>
    </div>

    <!-- Current Status -->
    <div class="demo-section">
      <h3>📊 Current Status</h3>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin: 20px 0;">
        <div>
          <h4>🔍 Device Info</h4>
          <div id="device-info">
            <div><span class="status-indicator active"></span>Device ID: <span id="device-id">Loading...</span></div>
            <div><span class="status-indicator active"></span>Browser: <span id="current-browser">Loading...</span></div>
            <div><span class="status-indicator active"></span>Auto-Sync: <span id="auto-sync-status">Ready</span></div>
          </div>
        </div>
        
        <div>
          <h4>💾 Current Data</h4>
          <div id="current-data">
            <div>Saved Movies: <span id="movie-count">0</span></div>
            <div>Watch Progress: <span id="progress-count">0</span></div>
            <div>User: <span id="user-name">Loading...</span></div>
          </div>
        </div>
        
        <div>
          <h4>🔄 Sync History</h4>
          <div id="sync-history">
            <div style="color: #888;">No sync events yet</div>
          </div>
        </div>
      </div>
      
      <div style="text-align: center; margin: 20px 0;">
        <button class="btn" onclick="refreshStatus()">🔄 Refresh Status</button>
        <button class="btn btn--success" onclick="addTestMovie()">➕ Add Test Movie</button>
        <button class="btn btn--warning" onclick="openSyncDialog()">⚙️ Sync Settings</button>
      </div>
    </div>

    <!-- How It Works -->
    <div class="demo-section">
      <h3>🎯 How It Works</h3>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
        <div>
          <h4 style="color: #00b894;">🚀 Auto-Sync Process</h4>
          <ol style="padding-left: 20px;">
            <li><strong>Device Detection:</strong> Tạo stable device fingerprint</li>
            <li><strong>Browser Registration:</strong> Đăng ký browser với Firebase</li>
            <li><strong>Real-time Listener:</strong> Listen changes từ browsers khác</li>
            <li><strong>Smart Sync:</strong> Auto-sync khi detect data mới</li>
            <li><strong>Instant Update:</strong> UI update trong 1-2 giây</li>
          </ol>
        </div>
        
        <div>
          <h4 style="color: #6c5ce7;">📱 Manual Sync Process</h4>
          <ol style="padding-left: 20px;">
            <li><strong>Generate Code:</strong> Tạo mã sync 6 số trên thiết bị A</li>
            <li><strong>Share Code:</strong> Chia sẻ mã với thiết bị B</li>
            <li><strong>Enter Code:</strong> Nhập mã trên thiết bị B</li>
            <li><strong>Verify & Sync:</strong> Xác thực và đồng bộ data</li>
            <li><strong>Complete:</strong> Data sync hoàn tất</li>
          </ol>
        </div>
      </div>
    </div>

    <!-- Live Demo -->
    <div class="demo-section">
      <h3>🎬 Live Demo Instructions</h3>
      
      <div style="background: #2a2a2a; padding: 20px; border-radius: 8px; margin: 15px 0;">
        <h4 style="color: #00b894;">🚀 Test Auto-Sync:</h4>
        <ol>
          <li>Mở trang này trên <strong>Microsoft Edge</strong></li>
          <li>Click "➕ Add Test Movie" để thêm vài phim</li>
          <li>Mở trang này trên <strong>Chrome/Opera</strong> (cùng máy tính)</li>
          <li>Chờ 2-3 giây → Phim sẽ tự động xuất hiện!</li>
          <li>Thêm phim trên Edge → Chrome sync ngay lập tức</li>
        </ol>
      </div>
      
      <div style="background: #2a2a2a; padding: 20px; border-radius: 8px; margin: 15px 0;">
        <h4 style="color: #6c5ce7;">📱 Test Manual Sync:</h4>
        <ol>
          <li>Click "⚙️ Sync Settings" trên PC</li>
          <li>Click "📤 Tạo mã" → Copy mã 6 số</li>
          <li>Mở trang trên điện thoại</li>
          <li>Click "⚙️ Sync Settings" → "📥 Nhập mã"</li>
          <li>Nhập mã → Data sync từ PC sang điện thoại!</li>
        </ol>
      </div>
    </div>

    <!-- Debug Console -->
    <div class="demo-section">
      <h3>🔧 Debug Console</h3>
      <div class="code-display" id="debug-console">
        [SYSTEM] GitHub Pages Sync System initialized<br>
        [AUTO-SYNC] Device fingerprint generated<br>
        [AUTO-SYNC] Real-time listener active<br>
        [READY] System ready for sync operations
      </div>
      <button class="btn" onclick="clearDebugConsole()">🗑️ Clear Console</button>
    </div>
  </div>

  <!-- Load Firebase and App -->
  <script src="./firebase-config.js"></script>
  <script src="./assets/app.js"></script>
  
  <script>
    let debugMessages = [
      '[SYSTEM] GitHub Pages Sync System initialized',
      '[AUTO-SYNC] Device fingerprint generated',
      '[AUTO-SYNC] Real-time listener active',
      '[READY] System ready for sync operations'
    ];
    
    function addDebugMessage(message) {
      const timestamp = new Date().toLocaleTimeString();
      debugMessages.push(`[${timestamp}] ${message}`);
      updateDebugConsole();
    }
    
    function updateDebugConsole() {
      const console = document.getElementById('debug-console');
      const recent = debugMessages.slice(-10);
      console.innerHTML = recent.map(msg => `<div>${msg}</div>`).join('');
    }
    
    function clearDebugConsole() {
      debugMessages = [
        '[SYSTEM] Debug console cleared',
        '[READY] System ready for sync operations'
      ];
      updateDebugConsole();
    }
    
    function refreshStatus() {
      try {
        if (window.movieComments) {
          // Device info
          const deviceId = window.movieComments._getSeamlessDeviceId ? 
            window.movieComments._getSeamlessDeviceId() : 'N/A';
          const browser = window.movieComments._getBrowserInfo ? 
            window.movieComments._getBrowserInfo() : 'Unknown';
          
          document.getElementById('device-id').textContent = deviceId.substring(0, 12) + '...';
          document.getElementById('current-browser').textContent = browser;
          
          // User info
          const userName = window.movieComments.getUserName();
          document.getElementById('user-name').textContent = userName;
          
          addDebugMessage(`Status refreshed - Device: ${deviceId.substring(0, 8)}... | Browser: ${browser}`);
          
          // Load data
          loadCurrentData();
        }
      } catch (error) {
        addDebugMessage(`ERROR: ${error.message}`);
      }
    }
    
    async function loadCurrentData() {
      try {
        if (window.movieComments) {
          const movies = await window.movieComments.getSavedMovies();
          const progress = await window.movieComments.getAllWatchProgress();
          
          document.getElementById('movie-count').textContent = movies.length;
          document.getElementById('progress-count').textContent = progress.length;
          
          addDebugMessage(`Data loaded - Movies: ${movies.length}, Progress: ${progress.length}`);
        }
      } catch (error) {
        addDebugMessage(`ERROR loading data: ${error.message}`);
      }
    }
    
    async function addTestMovie() {
      try {
        if (window.movieComments) {
          const testMovie = {
            slug: `demo-movie-${Date.now()}`,
            name: `Demo Movie ${new Date().toLocaleTimeString()}`,
            poster_url: 'https://via.placeholder.com/300x400',
            year: 2025,
            lang: 'Vietsub'
          };
          
          await window.movieComments.saveMovie(testMovie);
          
          addDebugMessage(`Movie added: ${testMovie.name}`);
          
          // Refresh data
          setTimeout(() => {
            loadCurrentData();
          }, 500);
        }
      } catch (error) {
        addDebugMessage(`ERROR adding movie: ${error.message}`);
      }
    }
    
    function testAutoSync() {
      addDebugMessage('AUTO-SYNC: Testing auto-sync between browsers');
      addDebugMessage('AUTO-SYNC: Open this page in different browsers on same device');
      addDebugMessage('AUTO-SYNC: Data will sync automatically within 2-3 seconds');
      
      // Trigger seamless sync check
      if (window.movieComments && window.movieComments._checkSeamlessAutoSync) {
        window.movieComments._checkSeamlessAutoSync();
        addDebugMessage('AUTO-SYNC: Seamless sync check triggered');
      }
    }
    
    function testManualSync() {
      addDebugMessage('MANUAL-SYNC: Testing manual sync for cross-device');
      addDebugMessage('MANUAL-SYNC: Use sync codes to sync between PC and phone');
      
      // Open sync dialog
      openSyncDialog();
    }
    
    function openSyncDialog() {
      if (window.movieComments && window.movieComments.showSyncDialog) {
        window.movieComments.showSyncDialog();
        addDebugMessage('SYNC-DIALOG: Opened sync settings dialog');
      }
    }
    
    // Listen for seamless sync events
    window.addEventListener('seamlessSync', (event) => {
      addDebugMessage(`AUTO-SYNC: Seamless sync event - ${event.detail.type}`);
      
      if (event.detail.type === 'dataRefresh') {
        setTimeout(() => {
          loadCurrentData();
        }, 500);
      }
    });
    
    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        refreshStatus();
        addDebugMessage('DEMO: GitHub Pages Sync Demo initialized');
      }, 1000);
      
      // Periodic status updates
      setInterval(() => {
        if (window.movieComments && window.movieComments.initialized) {
          document.getElementById('auto-sync-status').textContent = 'Active';
        }
      }, 5000);
    });
  </script>
</body>
</html>
