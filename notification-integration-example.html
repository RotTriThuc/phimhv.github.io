<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notification System Integration Example</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #fff;
    }
    
    .header {
      background: rgba(0,0,0,0.2);
      padding: 15px 0;
      backdrop-filter: blur(10px);
    }
    
    .header-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      font-size: 24px;
      font-weight: bold;
      color: #fff;
    }
    
    .header-actions {
      display: flex;
      gap: 15px;
      align-items: center;
    }
    
    .main-content {
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 20px;
    }
    
    .demo-section {
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 30px;
      backdrop-filter: blur(10px);
    }
    
    .demo-section h2 {
      margin-bottom: 20px;
      color: #fff;
    }
    
    .demo-buttons {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    .demo-btn {
      background: linear-gradient(135deg, #6c5ce7, #a29bfe);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .demo-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    
    .demo-btn.secondary {
      background: linear-gradient(135deg, #00b894, #00cec9);
    }
    
    .demo-btn.danger {
      background: linear-gradient(135deg, #e74c3c, #fd79a8);
    }
    
    .status-display {
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.5;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .log-entry {
      margin-bottom: 5px;
      opacity: 0.8;
    }
    
    .log-entry.success { color: #00b894; }
    .log-entry.error { color: #e74c3c; }
    .log-entry.info { color: #74b9ff; }
    
    @media (max-width: 768px) {
      .header-container {
        flex-direction: column;
        gap: 15px;
      }
      
      .demo-buttons {
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-container">
      <div class="logo">üé¨ Anime Web Demo</div>
      <div class="header-actions">
        <!-- Notification UI s·∫Ω ƒë∆∞·ª£c inject v√†o ƒë√¢y -->
        <button class="demo-btn" onclick="refreshPage()">üîÑ Refresh</button>
      </div>
    </div>
  </header>

  <main class="main-content">
    <div class="demo-section">
      <h2>üîî Notification System Demo</h2>
      <p>ƒê√¢y l√† demo t√≠ch h·ª£p h·ªá th·ªëng th√¥ng b√°o v√†o web xem anime. Notification button s·∫Ω xu·∫•t hi·ªán ·ªü header.</p>
      
      <div class="demo-buttons">
        <button class="demo-btn" onclick="testCreateNotification()">
          ‚úÖ T·∫°o th√¥ng b√°o test
        </button>
        <button class="demo-btn secondary" onclick="testMovieNotification()">
          üé¨ Th√¥ng b√°o phim m·ªõi
        </button>
        <button class="demo-btn secondary" onclick="testEpisodeNotification()">
          üì∫ Th√¥ng b√°o t·∫≠p m·ªõi
        </button>
        <button class="demo-btn" onclick="testMarkAllRead()">
          üëÅÔ∏è ƒê√°nh d·∫•u t·∫•t c·∫£ ƒë√£ ƒë·ªçc
        </button>
        <button class="demo-btn danger" onclick="clearAllNotifications()">
          üóëÔ∏è X√≥a t·∫•t c·∫£ th√¥ng b√°o
        </button>
      </div>
      
      <div class="status-display" id="status-display">
        <div class="log-entry info">üöÄ Notification system demo ready!</div>
        <div class="log-entry info">üí° Click c√°c button tr√™n ƒë·ªÉ test c√°c t√≠nh nƒÉng</div>
      </div>
    </div>

    <div class="demo-section">
      <h2>üìä Th·ªëng k√™ Real-time</h2>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
        <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 8px; text-align: center;">
          <div style="font-size: 24px; font-weight: bold;" id="total-notifications">-</div>
          <div style="opacity: 0.8;">T·ªïng th√¥ng b√°o</div>
        </div>
        <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 8px; text-align: center;">
          <div style="font-size: 24px; font-weight: bold;" id="unread-count">-</div>
          <div style="opacity: 0.8;">Ch∆∞a ƒë·ªçc</div>
        </div>
        <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 8px; text-align: center;">
          <div style="font-size: 24px; font-weight: bold;" id="firebase-status">üîÑ</div>
          <div style="opacity: 0.8;">Firebase Status</div>
        </div>
      </div>
    </div>

    <div class="demo-section">
      <h2>üîß Integration Code</h2>
      <p>ƒê·ªÉ t√≠ch h·ª£p notification system v√†o trang c·ªßa b·∫°n:</p>
      <div class="status-display">
        <div class="log-entry">1. Include Firebase config:</div>
        <div class="log-entry">&lt;script src="./firebase-config.js"&gt;&lt;/script&gt;</div>
        <div class="log-entry"></div>
        <div class="log-entry">2. Include notification UI module:</div>
        <div class="log-entry">&lt;script type="module"&gt;</div>
        <div class="log-entry">  import { notificationUI } from './modules/notification-ui.js';</div>
        <div class="log-entry">  await notificationUI.init('.header-actions');</div>
        <div class="log-entry">&lt;/script&gt;</div>
        <div class="log-entry"></div>
        <div class="log-entry">3. Notification button s·∫Ω t·ª± ƒë·ªông xu·∫•t hi·ªán!</div>
      </div>
    </div>
  </main>

  <!-- Firebase & Notification System -->
  <script src="./firebase-config.js"></script>
  <script type="module">
    import { notificationUI } from './modules/notification-ui.js';
    
    // Global functions for demo
    window.testCreateNotification = testCreateNotification;
    window.testMovieNotification = testMovieNotification;
    window.testEpisodeNotification = testEpisodeNotification;
    window.testMarkAllRead = testMarkAllRead;
    window.clearAllNotifications = clearAllNotifications;
    window.refreshPage = refreshPage;
    
    // Initialize notification system
    async function initDemo() {
      try {
        log('üîÑ Initializing notification system...', 'info');
        
        // Wait for Firebase to be ready
        if (window.movieComments) {
          await window.movieComments.init();
          log('‚úÖ Firebase initialized', 'success');
        }
        
        // Initialize notification UI
        await notificationUI.init('.header-actions');
        log('‚úÖ Notification UI initialized', 'success');
        
        // Update stats
        await updateStats();
        
        // Start real-time updates
        startRealTimeUpdates();
        
        log('üéâ Demo ready! Try the buttons above', 'success');
      } catch (error) {
        log(`‚ùå Init failed: ${error.message}`, 'error');
      }
    }
    
    // Demo functions
    async function testCreateNotification() {
      try {
        log('üîÑ Creating test notification...', 'info');
        
        await window.movieComments.createNotification({
          title: 'üì¢ Th√¥ng b√°o test',
          content: `ƒê√¢y l√† th√¥ng b√°o test ƒë∆∞·ª£c t·∫°o l√∫c ${new Date().toLocaleTimeString()}`,
          type: 'admin_announcement',
          metadata: { priority: 'normal' }
        });
        
        log('‚úÖ Test notification created', 'success');
        await updateStats();
      } catch (error) {
        log(`‚ùå Create failed: ${error.message}`, 'error');
      }
    }
    
    async function testMovieNotification() {
      try {
        log('üîÑ Creating movie notification...', 'info');
        
        await window.movieComments.createNotification({
          title: 'üé¨ Phim m·ªõi: Attack on Titan Final',
          content: 'Phim "Attack on Titan Final" (2024) v·ª´a ƒë∆∞·ª£c th√™m v√†o h·ªá th·ªëng. Xem ngay!',
          type: 'new_movie',
          metadata: { 
            priority: 'high',
            movieCount: 1,
            movies: [{ slug: 'attack-on-titan-final', name: 'Attack on Titan Final', year: 2024 }]
          }
        });
        
        log('‚úÖ Movie notification created', 'success');
        await updateStats();
      } catch (error) {
        log(`‚ùå Create failed: ${error.message}`, 'error');
      }
    }
    
    async function testEpisodeNotification() {
      try {
        log('üîÑ Creating episode notification...', 'info');
        
        await window.movieComments.createNotification({
          title: 'üì∫ T·∫≠p m·ªõi: One Piece',
          content: 'T·∫≠p 1100 c·ªßa "One Piece" ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t. Xem ngay!',
          type: 'new_movie',
          metadata: { 
            priority: 'normal',
            episodeCount: 1,
            episodes: [{ slug: 'one-piece', name: 'One Piece', episode: '1100' }]
          }
        });
        
        log('‚úÖ Episode notification created', 'success');
        await updateStats();
      } catch (error) {
        log(`‚ùå Create failed: ${error.message}`, 'error');
      }
    }
    
    async function testMarkAllRead() {
      try {
        log('üîÑ Marking all as read...', 'info');
        await notificationUI.markAllAsRead();
        log('‚úÖ All notifications marked as read', 'success');
        await updateStats();
      } catch (error) {
        log(`‚ùå Mark all read failed: ${error.message}`, 'error');
      }
    }
    
    async function clearAllNotifications() {
      if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t·∫•t c·∫£ th√¥ng b√°o?')) return;
      
      try {
        log('üîÑ Clearing all notifications...', 'info');
        
        const notifications = await window.movieComments.getNotifications({ limit: 100 });
        for (const notification of notifications) {
          await window.movieComments.deleteNotification(notification.id);
        }
        
        log('‚úÖ All notifications cleared', 'success');
        await updateStats();
      } catch (error) {
        log(`‚ùå Clear failed: ${error.message}`, 'error');
      }
    }
    
    function refreshPage() {
      window.location.reload();
    }
    
    // Utility functions
    function log(message, type = 'info') {
      const display = document.getElementById('status-display');
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      display.appendChild(entry);
      display.scrollTop = display.scrollHeight;
      
      // Keep only last 20 entries
      while (display.children.length > 20) {
        display.removeChild(display.firstChild);
      }
    }
    
    async function updateStats() {
      try {
        if (!window.movieComments || !window.movieComments.initialized) return;
        
        const [notifications, unreadCount] = await Promise.all([
          window.movieComments.getNotifications({ limit: 1000 }),
          window.movieComments.getUnreadNotificationCount()
        ]);
        
        document.getElementById('total-notifications').textContent = notifications.length;
        document.getElementById('unread-count').textContent = unreadCount;
        document.getElementById('firebase-status').textContent = '‚úÖ';
      } catch (error) {
        document.getElementById('firebase-status').textContent = '‚ùå';
        console.error('Update stats failed:', error);
      }
    }
    
    function startRealTimeUpdates() {
      // Update stats every 10 seconds
      setInterval(updateStats, 10000);
    }
    
    // Initialize when DOM ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initDemo);
    } else {
      initDemo();
    }
  </script>
</body>
</html>
